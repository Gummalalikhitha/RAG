<!-- # templates/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>RAG with pgvector</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h1>ðŸ“š Local RAG with PostgreSQL (pgvector)</h1>

        <section class="upload">
            <h2>Upload Document</h2>
            <form id="uploadForm" enctype="multipart/form-data">
                <input type="text" name="source" placeholder="Source name" required>
                <input type="file" name="file" required>
                <button type="submit">Upload</button>
            </form>
            <div id="uploadStatus"></div>
        </section>

        <section class="query">
            <h2>Ask a Question</h2>
            <form id="queryForm">
                <input type="text" name="q" placeholder="Enter your question..." required>
                <button type="submit">Ask</button>
            </form>
            <div id="response"></div>
        </section>
    </div>

    <script>
        const uploadForm = document.getElementById('uploadForm');
        const queryForm = document.getElementById('queryForm');

        uploadForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(uploadForm);
            const res = await fetch('/upload/', { method: 'POST', body: formData });
            const data = await res.json();
            document.getElementById('uploadStatus').innerHTML = `âœ… Uploaded ${data.inserted_chunks} chunks`;
        });

        queryForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(queryForm);
            const res = await fetch('/query/', { method: 'POST', body: formData });
            const data = await res.json();
            const resultDiv = document.getElementById('response');
            resultDiv.innerHTML = "<h3>Top Answers:</h3>";
            data.results.forEach(r => {
                resultDiv.innerHTML += `<p><b>Chunk:</b> ${r.text_chunk}<br><b>Similarity:</b> ${r.similarity.toFixed(4)}</p>`;
            });
        });
    </script>
</body>
</html>
